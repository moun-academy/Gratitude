<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF 8" />
  <meta name="viewport" content="width=device width, initial scale=1.0" />
  <title>Truth, Identity, Alignment</title>

  <style>
    :root {
      --primary: #6366f1;
      --primaryDark: #4f46e5;
      --secondary: #ec4899;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;

      --bg0: #0b1020;
      --bg1: #0f172a;
      --bg2: #141f3a;
      --panel: rgba(30, 41, 59, 0.75);
      --panelSolid: #1e293b;
      --panelSoft: rgba(30, 41, 59, 0.45);

      --text: #f1f5f9;
      --text2: #cbd5e1;
      --muted: #94a3b8;
      --border: rgba(148, 163, 184, 0.18);

      --shadow: 0 18px 45px rgba(0, 0, 0, 0.35);
      --glow: 0 0 18px rgba(99, 102, 241, 0.24);

      --r1: 22px;
      --r2: 16px;
      --r3: 12px;

      --mono: ui monospace, SFMono Regular, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace;
    }

    * {
      margin: 0;
      padding: 0;
      box sizing: border box;
    }

    body {
      font family: Inter, system ui, -apple system, Segoe UI, sans serif;
      background: radial gradient(circle at 12% 10%, rgba(99, 102, 241, 0.22), transparent 40%),
                  radial gradient(circle at 88% 22%, rgba(236, 72, 153, 0.18), transparent 45%),
                  linear gradient(135deg, var(--bg0) 0%, var(--bg1) 45%, #0b1226 100%);
      color: var(--text);
      min height: 100vh;
      padding: 18px;
      line height: 1.6;
    }

    .container {
      max width: 1100px;
      margin: 0 auto;
    }

    header.hero {
      padding: 34px 26px;
      border radius: var(--r1);
      background: linear gradient(135deg, rgba(99, 102, 241, 0.95) 0%, rgba(236, 72, 153, 0.90) 100%);
      box shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      margin bottom: 18px;
    }

    header.hero::before {
      content: "";
      position: absolute;
      inset: -60px;
      background:
        radial gradient(circle, rgba(255, 255, 255, 0.12) 1px, transparent 1px);
      background size: 18px 18px;
      opacity: 0.22;
      transform: rotate(12deg);
    }

    header.hero .heroInner {
      position: relative;
      display: flex;
      flex direction: column;
      gap: 8px;
    }

    header.hero h1 {
      font size: 34px;
      font weight: 900;
      letter spacing: 0.02em;
      text shadow: 0 2px 14px rgba(0, 0, 0, 0.25);
    }

    header.hero p {
      font size: 14px;
      color: rgba(255, 255, 255, 0.92);
      max width: 720px;
    }

    .topMeta {
      display: flex;
      flex wrap: wrap;
      gap: 10px;
      margin top: 10px;
      align items: center;
    }

    .pill {
      display: inline flex;
      align items: center;
      gap: 8px;
      padding: 8px 12px;
      border radius: 999px;
      background: rgba(15, 23, 42, 0.20);
      border: 1px solid rgba(255, 255, 255, 0.22);
      font size: 12px;
      font weight: 800;
      letter spacing: 0.02em;
      backdrop filter: blur(14px);
    }

    .pill span.k {
      font family: var(--mono);
      font weight: 900;
    }

    .layout {
      display: grid;
      grid template columns: 1fr;
      gap: 16px;
    }

    @media (min width: 980px) {
      .layout { grid template columns: 1.35fr 0.65fr; }
    }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border radius: var(--r1);
      box shadow: var(--shadow);
      backdrop filter: blur(18px);
    }

    .cardBody {
      padding: 18px;
    }

    .statsGrid {
      display: grid;
      grid template columns: repeat(3, 1fr);
      gap: 12px;
      margin bottom: 14px;
    }

    @media (max width: 820px) {
      .statsGrid { grid template columns: 1fr; }
    }

    .statCard {
      background: rgba(15, 23, 42, 0.34);
      border: 1px solid rgba(148, 163, 184, 0.18);
      border radius: var(--r2);
      padding: 16px;
      position: relative;
      overflow: hidden;
      transition: transform 0.25s ease, box shadow 0.25s ease, border color 0.25s ease;
    }

    .statCard::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear gradient(90deg, var(--primary), var(--secondary));
      opacity: 0.95;
    }

    .statCard:hover {
      transform: translateY(-3px);
      box shadow: var(--glow), var(--shadow);
      border color: rgba(99, 102, 241, 0.35);
    }

    .statLabel {
      font size: 12px;
      color: var(--muted);
      text transform: uppercase;
      letter spacing: 0.10em;
      font weight: 800;
      margin bottom: 8px;
    }

    .statValue {
      font size: 34px;
      font weight: 900;
      background: linear gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      -webkit background clip: text;
      -webkit text fill color: transparent;
      background clip: text;
    }

    .statHint {
      margin top: 6px;
      font size: 12px;
      color: var(--text2);
    }

    .tabs {
      display: flex;
      gap: 10px;
      background: rgba(15, 23, 42, 0.35);
      border: 1px solid rgba(148, 163, 184, 0.18);
      padding: 8px;
      border radius: var(--r2);
      margin bottom: 14px;
    }

    @media (max width: 820px) {
      .tabs { flex direction: column; }
    }

    .tabBtn {
      flex: 1;
      border: none;
      cursor: pointer;
      padding: 12px 14px;
      border radius: 12px;
      background: transparent;
      color: var(--text2);
      font size: 14px;
      font weight: 800;
      transition: background 0.25s ease, color 0.25s ease, box shadow 0.25s ease;
    }

    .tabBtn.active {
      background: linear gradient(135deg, rgba(99, 102, 241, 0.95) 0%, rgba(236, 72, 153, 0.92) 100%);
      color: white;
      box shadow: 0 6px 18px rgba(99, 102, 241, 0.25);
    }

    .panel {
      display: none;
      animation: fadeIn 0.35s ease;
    }

    .panel.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .sectionTitle {
      font size: 12px;
      color: var(--muted);
      text transform: uppercase;
      letter spacing: 0.12em;
      font weight: 900;
      margin: 16px 0 10px;
    }

    .softBox {
      background: rgba(15, 23, 42, 0.28);
      border: 1px solid rgba(148, 163, 184, 0.16);
      border radius: var(--r2);
      padding: 16px;
    }

    .truthBox {
      background: radial gradient(circle at 12% 15%, rgba(99, 102, 241, 0.25), transparent 55%),
                  radial gradient(circle at 88% 30%, rgba(236, 72, 153, 0.18), transparent 55%),
                  rgba(15, 23, 42, 0.25);
      border: 1px solid rgba(99, 102, 241, 0.25);
    }

    .truthLabel {
      font size: 12px;
      color: var(--text2);
      font weight: 900;
      opacity: 0.95;
      margin bottom: 8px;
    }

    .truthText {
      font size: 16px;
      font weight: 900;
      line height: 1.35;
      margin bottom: 8px;
    }

    .truthQ {
      font size: 13px;
      color: var(--text2);
      line height: 1.5;
    }

    .field {
      margin top: 10px;
    }

    .field label {
      display: flex;
      justify content: space between;
      align items: baseline;
      gap: 10px;
      margin bottom: 8px;
      font size: 13px;
      color: var(--text2);
      font weight: 800;
    }

    .smallMeta {
      font size: 12px;
      color: var(--muted);
      font weight: 800;
    }

    textarea, input[type="text"] {
      width: 100%;
      border radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.22);
      background: rgba(51, 65, 85, 0.35);
      color: var(--text);
      padding: 14px 14px;
      font size: 14px;
      outline: none;
      transition: border color 0.25s ease, box shadow 0.25s ease;
    }

    textarea {
      min height: 120px;
      resize: vertical;
      max height: 280px;
    }

    textarea:focus, input[type="text"]:focus {
      border color: rgba(99, 102, 241, 0.60);
      box shadow: 0 0 0 3px rgba(99, 102, 241, 0.14);
    }

    .rowGrid {
      display: grid;
      grid template columns: repeat(3, 1fr);
      gap: 12px;
    }

    @media (max width: 820px) {
      .rowGrid { grid template columns: 1fr; }
    }

    .sliderBox {
      background: rgba(15, 23, 42, 0.28);
      border: 1px solid rgba(148, 163, 184, 0.16);
      border radius: var(--r2);
      padding: 16px;
    }

    .sliderTitle {
      display: flex;
      justify content: space between;
      align items: baseline;
      font weight: 900;
      margin bottom: 10px;
      color: var(--text2);
      font size: 13px;
    }

    .sliderTitle .value {
      font family: var(--mono);
      font weight: 900;
      color: rgba(255, 255, 255, 0.90);
    }

    input[type="range"] {
      width: 100%;
      height: 8px;
      border radius: 999px;
      background: rgba(148, 163, 184, 0.18);
      outline: none;
      -webkit appearance: none;
      appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit appearance: none;
      appearance: none;
      width: 22px;
      height: 22px;
      border radius: 50%;
      background: linear gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      box shadow: 0 6px 18px rgba(99, 102, 241, 0.35);
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.10);
    }

    input[type="range"]::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border radius: 50%;
      background: linear gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      border: none;
      cursor: pointer;
    }

    .btnRow {
      display: flex;
      gap: 10px;
      flex wrap: wrap;
      margin top: 14px;
    }

    .btn {
      border: none;
      cursor: pointer;
      padding: 13px 16px;
      border radius: 14px;
      font weight: 900;
      font size: 14px;
      transition: transform 0.2s ease, box shadow 0.2s ease;
    }

    .btnPrimary {
      background: linear gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      box shadow: 0 8px 22px rgba(99, 102, 241, 0.28);
    }

    .btnGhost {
      background: rgba(15, 23, 42, 0.18);
      color: var(--text);
      border: 1px solid rgba(148, 163, 184, 0.22);
    }

    .btnDanger {
      background: rgba(239, 68, 68, 0.12);
      color: #fecaca;
      border: 1px solid rgba(239, 68, 68, 0.32);
    }

    .btn:hover { transform: translateY(-2px); }
    .btn:active { transform: translateY(0); }

    .rightSticky {
      position: sticky;
      top: 18px;
    }

    .miniBox {
      background: rgba(15, 23, 42, 0.28);
      border: 1px solid rgba(148, 163, 184, 0.16);
      border radius: var(--r2);
      padding: 16px;
      margin bottom: 12px;
    }

    .miniTitle {
      font size: 12px;
      color: var(--muted);
      text transform: uppercase;
      letter spacing: 0.12em;
      font weight: 900;
      margin bottom: 8px;
    }

    .miniText {
      font size: 14px;
      font weight: 900;
      line height: 1.35;
    }

    .miniSub {
      margin top: 8px;
      color: var(--text2);
      font size: 12px;
      line height: 1.5;
    }

    .list {
      display: flex;
      flex direction: column;
      gap: 10px;
    }

    .listItem {
      background: rgba(15, 23, 42, 0.22);
      border: 1px solid rgba(148, 163, 184, 0.16);
      border radius: var(--r2);
      padding: 14px;
      cursor: pointer;
      transition: transform 0.18s ease, border color 0.18s ease, box shadow 0.18s ease;
    }

    .listItem:hover {
      transform: translateX(4px);
      border color: rgba(99, 102, 241, 0.30);
      box shadow: var(--glow);
    }

    .listHead {
      display: flex;
      justify content: space between;
      align items: baseline;
      gap: 10px;
      margin bottom: 6px;
    }

    .listDate {
      font weight: 900;
      color: rgba(255, 255, 255, 0.92);
      font size: 13px;
    }

    .listMeta {
      font size: 12px;
      color: var(--muted);
      font family: var(--mono);
      font weight: 900;
    }

    .hr {
      height: 1px;
      background: rgba(148, 163, 184, 0.14);
      margin: 16px 0;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear gradient(135deg, rgba(16, 185, 129, 0.95), rgba(5, 150, 105, 0.95));
      color: white;
      padding: 14px 16px;
      border radius: 14px;
      box shadow: var(--shadow);
      transform: translateX(420px);
      transition: transform 0.25s ease;
      z index: 9999;
      max width: 360px;
      font weight: 900;
      font size: 14px;
    }

    .toast.show { transform: translateX(0); }

    .toggleRow {
      display: flex;
      align items: center;
      justify content: space between;
      gap: 12px;
      padding: 14px 16px;
      border radius: var(--r2);
      background: rgba(15, 23, 42, 0.22);
      border: 1px solid rgba(148, 163, 184, 0.16);
    }

    .toggleRow .left {
      display: flex;
      flex direction: column;
      gap: 4px;
    }

    .toggleRow .left .t1 { font weight: 900; }
    .toggleRow .left .t2 { color: var(--muted); font size: 12px; }

    .toggleRow input { transform: scale(1.2); }

    .mutedLine { color: var(--muted); font size: 13px; }

    @media (max width: 980px) {
      .rightSticky { position: static; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="hero">
      <div class="heroInner">
        <h1>Truth, Identity, Alignment</h1>
        <p>A daily system that hits you with truth, pulls you into your identity, and audits your alignment at night.</p>
        <div class="topMeta">
          <div class="pill">Today <span class="k" id="todayIso">0000 00 00</span></div>
          <div class="pill">Mode <span class="k" id="modePill">Quick</span></div>
          <div class="pill">Streak <span class="k" id="streakPill">0</span></div>
        </div>
      </div>
    </header>

    <div class="layout">
      <div class="card">
        <div class="cardBody">
          <div class="statsGrid">
            <div class="statCard">
              <div class="statLabel">Vitality</div>
              <div class="statValue" id="topVitality">0</div>
              <div class="statHint">Rest and optimism, the fuel.</div>
            </div>
            <div class="statCard">
              <div class="statLabel">Courage</div>
              <div class="statValue" id="topCourage">0</div>
              <div class="statHint">Challenges and alignment.</div>
            </div>
            <div class="statCard">
              <div class="statLabel">Meaning</div>
              <div class="statValue" id="topMeaning">0</div>
              <div class="statHint">Fulfillment, connection, fear faced.</div>
            </div>
          </div>

          <div class="tabs">
            <button class="tabBtn active" dataTab="morningPanel">Morning</button>
            <button class="tabBtn" dataTab="eveningPanel">Evening</button>
            <button class="tabBtn" dataTab="dashboardPanel">Dashboard</button>
            <button class="tabBtn" dataTab="historyPanel">History</button>
            <button class="tabBtn" dataTab="settingsPanel">Settings</button>
          </div>

          <div class="panel active" id="morningPanel">
            <div class="toggleRow">
              <div class="left">
                <div class="t1">Deep Mode</div>
                <div class="t2">Shows extra metrics and longer work, Quick Mode stays light</div>
              </div>
              <input type="checkbox" id="deepModeToggle" />
            </div>

            <div class="sectionTitle">Wake up truth</div>
            <div class="softBox truthBox">
              <div class="truthLabel">Truth of the day</div>
              <div class="truthText" id="truthText">Loading</div>
              <div class="truthQ" id="truthQuestion">Loading</div>
            </div>

            <div class="sectionTitle">Your truth response</div>
            <div class="field">
              <label><span>Write the raw answer</span><span class="smallMeta" id="morningSaved">Not saved</span></label>
              <textarea id="mTruthAnswer" placeholder="Write honestly. No polishing."></textarea>
            </div>

            <div class="sectionTitle">Foundational question</div>
            <div class="softBox">
              <div class="truthText" style="font size: 15px;" id="foundationQ">Loading</div>
              <div class="truthQ" id="foundationHint">Loading</div>
            </div>

            <div class="field">
              <label><span>Your answer</span><span class="smallMeta">One honest paragraph</span></label>
              <textarea id="mFoundationAnswer" placeholder="Answer it like your life matters."></textarea>
            </div>

            <div id="morningMetricsWrap">
              <div class="sectionTitle">Morning metrics</div>
              <div class="rowGrid">
                <div class="sliderBox">
                  <div class="sliderTitle"><span>Rested</span><span class="value" id="mRestedVal">5</span></div>
                  <input type="range" min="1" max="10" value="5" id="mRested" />
                </div>
                <div class="sliderBox">
                  <div class="sliderTitle"><span>Optimism</span><span class="value" id="mOptimismVal">5</span></div>
                  <input type="range" min="1" max="10" value="5" id="mOptimism" />
                </div>
                <div class="sliderBox">
                  <div class="sliderTitle"><span>Confidence</span><span class="value" id="mConfidenceVal">5</span></div>
                  <input type="range" min="1" max="10" value="5" id="mConfidence" />
                </div>
              </div>
              <div class="mutedLine" style="margin top: 10px;">Quick Mode can skip this. Deep Mode builds patterns.</div>
            </div>

            <div class="sectionTitle">Identity declaration</div>
            <div class="field">
              <label><span>Who are you becoming?</span><span class="smallMeta">One sentence</span></label>
              <input type="text" id="mIdentity" placeholder="Example: I move first even when I blush." />
            </div>

            <div class="sectionTitle">Today action</div>
            <div class="field">
              <label><span>What will you do today?</span><span class="smallMeta">Specific</span></label>
              <input type="text" id="mAction" placeholder="Example: Start 3 conversations before noon." />
            </div>

            <div class="btnRow">
              <button class="btn btnPrimary" id="saveMorningBtn">Save Morning</button>
              <button class="btn btnGhost" id="loadMorningBtn">Load Saved</button>
            </div>
          </div>

          <div class="panel" id="eveningPanel">
            <div class="sectionTitle">Evening assessment</div>
            <div class="rowGrid">
              <div class="sliderBox">
                <div class="sliderTitle"><span>Happiness</span><span class="value" id="eHappyVal">5</span></div>
                <input type="range" min="1" max="10" value="5" id="eHappy" />
              </div>
              <div class="sliderBox">
                <div class="sliderTitle"><span>Fulfillment</span><span class="value" id="eFulfillVal">5</span></div>
                <input type="range" min="1" max="10" value="5" id="eFulfill" />
              </div>
              <div class="sliderBox">
                <div class="sliderTitle"><span>Handled challenges</span><span class="value" id="eChallengesVal">5</span></div>
                <input type="range" min="1" max="10" value="5" id="eChallenges" />
              </div>
            </div>

            <div class="rowGrid" style="margin top: 12px;">
              <div class="sliderBox" style="grid column: 1 / -1;">
                <div class="sliderTitle"><span>Connection</span><span class="value" id="eConnectionVal">5</span></div>
                <input type="range" min="1" max="10" value="5" id="eConnection" />
              </div>
            </div>

            <div class="sectionTitle">Gratitude and learning</div>
            <div class="rowGrid" style="grid template columns: repeat(2, 1fr);">
              <div class="softBox">
                <div class="field" style="margin top: 0;">
                  <label><span>What made you smile?</span><span class="smallMeta">One moment</span></label>
                  <textarea id="eSmile" placeholder="Name the moment."></textarea>
                </div>
              </div>
              <div class="softBox">
                <div class="field" style="margin top: 0;">
                  <label><span>What did you learn?</span><span class="smallMeta">One sentence</span></label>
                  <textarea id="eLearn" placeholder="Name the lesson."></textarea>
                </div>
              </div>
            </div>

            <div class="sectionTitle">Identity alignment</div>
            <div class="softBox">
              <div class="mutedLine">Declared identity</div>
              <div class="truthText" style="font size: 15px; margin top: 6px;" id="identityEcho">Not set</div>
              <div class="mutedLine" style="margin top: 10px;">Declared action</div>
              <div class="truthText" style="font size: 15px; margin top: 6px;" id="actionEcho">Not set</div>
            </div>

            <div class="sliderBox" style="margin top: 12px;">
              <div class="sliderTitle"><span>Alignment score</span><span class="value" id="eAlignVal">5</span></div>
              <input type="range" min="1" max="10" value="5" id="eAlign" />
            </div>

            <div class="rowGrid" style="grid template columns: repeat(2, 1fr); margin top: 12px;">
              <div class="softBox">
                <div class="field" style="margin top: 0;">
                  <label><span>Where did you fall short?</span><span class="smallMeta">Honesty</span></label>
                  <textarea id="eShort" placeholder="Name the moment you played small."></textarea>
                </div>
              </div>
              <div class="softBox">
                <div class="field" style="margin top: 0;">
                  <label><span>Where did you rise?</span><span class="smallMeta">Celebrate</span></label>
                  <textarea id="eProud" placeholder="Name the rep you respect."></textarea>
                </div>
              </div>
            </div>

            <div class="softBox" style="margin top: 12px;">
              <label style="display:flex; align items:center; gap:10px; cursor:pointer; font weight:900;">
                <input type="checkbox" id="eFear" style="transform: scale(1.2);" />
                I confronted a fear today
              </label>
              <div class="mutedLine" style="margin top: 8px;">This is the point of the system.</div>
            </div>

            <div class="sectionTitle">Tomorrow commitment</div>
            <div class="field">
              <label><span>One specific action</span><span class="smallMeta">One thing</span></label>
              <input type="text" id="eTomorrow" placeholder="Example: Ask 1 stranger a question and hold eye contact." />
            </div>

            <div class="btnRow">
              <button class="btn btnPrimary" id="saveEveningBtn">Save Evening</button>
              <button class="btn btnGhost" id="loadEveningBtn">Load Saved</button>
            </div>

            <div class="mutedLine" style="margin top: 12px;" id="eveningSaved">Not saved</div>
          </div>

          <div class="panel" id="dashboardPanel">
            <div class="sectionTitle">Averages and insights</div>
            <div class="softBox">
              <div class="truthText" style="font size: 15px;">Weekly view</div>
              <div class="mutedLine" id="avgText">No data yet.</div>
              <div class="hr"></div>
              <div class="truthText" style="font size: 15px;">Insights</div>
              <div class="mutedLine" id="insightText">Log a few complete days and patterns will appear here.</div>
            </div>
          </div>

          <div class="panel" id="historyPanel">
            <div class="sectionTitle">Past days</div>
            <div class="list" id="historyList"></div>
            <div class="mutedLine" style="margin top: 10px;">Tap a day to load it into Morning and Evening.</div>
          </div>

          <div class="panel" id="settingsPanel">
            <div class="sectionTitle">Storage</div>
            <div class="softBox">
              <div class="mutedLine">Everything is stored locally on this device.</div>
              <div class="btnRow" style="margin top: 12px;">
                <button class="btn btnDanger" id="resetAllBtn">Reset all data</button>
                <button class="btn btnGhost" id="exportBtn">Export JSON</button>
                <button class="btn btnGhost" id="importBtn">Import JSON</button>
              </div>
              <textarea id="transferBox" style="margin top: 12px;" placeholder="Export appears here. To import, paste JSON here, then click Import JSON."></textarea>
            </div>
          </div>

        </div>
      </div>

      <div class="rightSticky">
        <div class="card">
          <div class="cardBody">
            <div class="miniBox truthBox">
              <div class="miniTitle">Today truth</div>
              <div class="miniText" id="rightTruth">Loading</div>
              <div class="miniSub" id="rightQuestion">Loading</div>
            </div>

            <div class="miniBox">
              <div class="miniTitle">Today focus</div>
              <div class="miniText" id="rightFoundation">Loading</div>
              <div class="miniSub">One question per day keeps you sharp without overwhelm.</div>
            </div>

            <div class="miniBox">
              <div class="miniTitle">Declared identity</div>
              <div class="miniText" id="rightIdentity">Not set</div>
              <div class="miniSub" style="margin top: 10px;">Declared action</div>
              <div class="miniText" id="rightAction" style="margin top: 6px;">Not set</div>
            </div>

            <div class="miniBox">
              <div class="miniTitle">Rule</div>
              <div class="miniSub">The feeling is not the enemy. Avoidance is the enemy. Your response writes the story.</div>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const KEY_STATE = "tiaStateV2";
    const KEY_DAYS = "tiaDaysV2";

    const TRUTHS = [
      { truth: "You are the youngest you will ever be.", question: "If today is the youngest, strongest version of you that will ever exist, what will you do with it that your older self will thank you for?" },
      { truth: "Every day might be your last.", question: "If today was the final page of your life, how would you want the story to end by midnight?" },
      { truth: "You are wealthier than most of the world.", question: "With the level of wealth, safety, and freedom you have, what excuse do you actually have to play small?" },
      { truth: "You have opportunities people would kill for.", question: "If someone with nothing had your life for 24 hours, how much harder would they push than you?" },
      { truth: "Your life is not guaranteed beyond today.", question: "If life was borrowed time, how would you spend the next twelve hours?" }
    ];

    const FOUNDATIONS = [
      { q: "Are you healthy today?", hint: "If the answer is yes, what is stopping you from using this body fully?" },
      { q: "Do you have someone or a group of people who would come to your funeral even if it rained?", hint: "If not, how will you build relationships worth dying for?" },
      { q: "If you were to die tonight, what would people say about you?", hint: "Is that acceptable to you?" },
      { q: "What can you do today so that by bedtime you feel genuine pride instead of regret?", hint: "One action. One rep. Something you respect." },
      { q: "What fear or insecurity will you confront today to raise your character one level higher?", hint: "Name it. Do it early. Do not negotiate with it." }
    ];

    function isoToday() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${y}-${m}-${day}`;
    }

    function dayIndex(iso) {
      const parts = iso.split("-").map(Number);
      const dt = new Date(parts[0], parts[1] - 1, parts[2]);
      return Math.floor(dt.getTime() / 86400000);
    }

    function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }

    function loadJSON(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        if (!raw) return fallback;
        return JSON.parse(raw);
      } catch (e) {
        return fallback;
      }
    }

    function saveJSON(key, obj) {
      localStorage.setItem(key, JSON.stringify(obj));
    }

    function getState() {
      return loadJSON(KEY_STATE, { deepMode: false, lastTab: "morningPanel" });
    }

    function setState(s) { saveJSON(KEY_STATE, s); }

    function getDays() { return loadJSON(KEY_DAYS, {}); }

    function setDays(d) { saveJSON(KEY_DAYS, d); }

    function ensureDay(iso) {
      const days = getDays();
      if (!days[iso]) {
        days[iso] = {
          iso,
          truthIndex: dayIndex(iso) % TRUTHS.length,
          foundationIndex: dayIndex(iso) % FOUNDATIONS.length,
          morning: { truthAnswer: "", foundationAnswer: "", rested: 5, optimism: 5, confidence: 5, identity: "", action: "", savedAt: "" },
          evening: { happy: 5, fulfill: 5, challenges: 5, connection: 5, smile: "", learn: "", align: 5, short: "", proud: "", fearFaced: false, tomorrow: "", savedAt: "" }
        };
        setDays(days);
      }
      return days[iso];
    }

    function nowStamp() {
      const d = new Date();
      const hh = String(d.getHours()).padStart(2, "0");
      const mm = String(d.getMinutes()).padStart(2, "0");
      return `${hh}:${mm}`;
    }

    function isMorningSaved(day) { return Boolean(day.morning.savedAt); }
    function isEveningSaved(day) { return Boolean(day.evening.savedAt); }
    function isDayComplete(day) { return isMorningSaved(day) && isEveningSaved(day); }

    function calcVitality(day) {
      const m = day.morning;
      const v = ((Number(m.rested || 5) * 0.5) + (Number(m.optimism || 5) * 0.5)) * 10;
      return clamp(Math.round(v), 0, 100);
    }

    function calcCourage(day) {
      const m = day.morning;
      const e = day.evening;
      const c = ((Number(m.confidence || 5) * 0.4) + (Number(e.challenges || 5) * 0.4) + (Number(e.align || 5) * 0.2)) * 10;
      return clamp(Math.round(c), 0, 100);
    }

    function calcMeaning(day) {
      const e = day.evening;
      let base = ((Number(e.fulfill || 5) * 0.6) + (Number(e.connection || 5) * 0.4)) * 10;
      if (e.fearFaced) base += 8;
      return clamp(Math.round(base), 0, 100);
    }

    function getRecentIsos(n) {
      const out = [];
      const now = new Date();
      for (let i = 0; i < n; i++) {
        const d = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        d.setDate(d.getDate() - i);
        const iso = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
        out.push(iso);
      }
      return out;
    }

    function computeStreak(days) {
      const recent = getRecentIsos(400);
      let streak = 0;
      for (const iso of recent) {
        if (days[iso] && isDayComplete(days[iso])) streak++;
        else break;
      }
      return streak;
    }

    function averageScore(days, isos, fn) {
      const vals = [];
      for (const iso of isos) {
        const d = days[iso];
        if (!d) continue;
        if (!isDayComplete(d)) continue;
        vals.push(fn(d));
      }
      if (vals.length === 0) return null;
      const sum = vals.reduce((a, b) => a + b, 0);
      return Math.round(sum / vals.length);
    }

    function buildInsights(days) {
      const isos30 = getRecentIsos(30);
      const rows = [];
      for (const iso of isos30) {
        const d = days[iso];
        if (!d || !isDayComplete(d)) continue;
        rows.push({
          vitality: calcVitality(d),
          courage: calcCourage(d),
          meaning: calcMeaning(d),
          fear: !!d.evening.fearFaced,
          rested: Number(d.morning.rested || 5),
          align: Number(d.evening.align || 5)
        });
      }
      if (rows.length < 6) return "Log at least 6 complete days and patterns will appear.";

      const avg = (arr, key) => Math.round(arr.reduce((s, x) => s + x[key], 0) / arr.length);

      const fearDays = rows.filter(r => r.fear);
      const noFearDays = rows.filter(r => !r.fear);

      const lines = [];

      if (fearDays.length >= 2 && noFearDays.length >= 2) {
        const diff = avg(fearDays, "meaning") - avg(noFearDays, "meaning");
        lines.push(`Meaning changes when you face fear. Difference: ${diff} points.`);
      }

      const highRest = rows.filter(r => r.rested >= 8);
      const lowRest = rows.filter(r => r.rested <= 4);
      if (highRest.length >= 2 && lowRest.length >= 2) {
        const diff = avg(highRest, "vitality") - avg(lowRest, "vitality");
        lines.push(`Rest changes Vitality. Difference: ${diff} points.`);
      }

      const highAlign = rows.filter(r => r.align >= 8);
      const lowAlign = rows.filter(r => r.align <= 4);
      if (highAlign.length >= 2 && lowAlign.length >= 2) {
        const diff = avg(highAlign, "courage") - avg(lowAlign, "courage");
        lines.push(`Alignment drives Courage. Difference: ${diff} points.`);
      }

      return lines.length ? lines.join(" ") : "Your patterns are still forming. Keep logging.";
    }

    const ui = {
      todayIso: document.getElementById("todayIso"),
      modePill: document.getElementById("modePill"),
      streakPill: document.getElementById("streakPill"),

      topVitality: document.getElementById("topVitality"),
      topCourage: document.getElementById("topCourage"),
      topMeaning: document.getElementById("topMeaning"),

      truthText: document.getElementById("truthText"),
      truthQuestion: document.getElementById("truthQuestion"),

      foundationQ: document.getElementById("foundationQ"),
      foundationHint: document.getElementById("foundationHint"),

      rightTruth: document.getElementById("rightTruth"),
      rightQuestion: document.getElementById("rightQuestion"),
      rightFoundation: document.getElementById("rightFoundation"),
      rightIdentity: document.getElementById("rightIdentity"),
      rightAction: document.getElementById("rightAction"),

      deepToggle: document.getElementById("deepModeToggle"),
      morningMetricsWrap: document.getElementById("morningMetricsWrap"),

      mTruthAnswer: document.getElementById("mTruthAnswer"),
      mFoundationAnswer: document.getElementById("mFoundationAnswer"),
      mRested: document.getElementById("mRested"),
      mOptimism: document.getElementById("mOptimism"),
      mConfidence: document.getElementById("mConfidence"),
      mRestedVal: document.getElementById("mRestedVal"),
      mOptimismVal: document.getElementById("mOptimismVal"),
      mConfidenceVal: document.getElementById("mConfidenceVal"),
      mIdentity: document.getElementById("mIdentity"),
      mAction: document.getElementById("mAction"),
      morningSaved: document.getElementById("morningSaved"),

      eHappy: document.getElementById("eHappy"),
      eFulfill: document.getElementById("eFulfill"),
      eChallenges: document.getElementById("eChallenges"),
      eConnection: document.getElementById("eConnection"),
      eHappyVal: document.getElementById("eHappyVal"),
      eFulfillVal: document.getElementById("eFulfillVal"),
      eChallengesVal: document.getElementById("eChallengesVal"),
      eConnectionVal: document.getElementById("eConnectionVal"),
      eSmile: document.getElementById("eSmile"),
      eLearn: document.getElementById("eLearn"),
      eAlign: document.getElementById("eAlign"),
      eAlignVal: document.getElementById("eAlignVal"),
      eShort: document.getElementById("eShort"),
      eProud: document.getElementById("eProud"),
      eFear: document.getElementById("eFear"),
      eTomorrow: document.getElementById("eTomorrow"),
      eveningSaved: document.getElementById("eveningSaved"),

      identityEcho: document.getElementById("identityEcho"),
      actionEcho: document.getElementById("actionEcho"),

      avgText: document.getElementById("avgText"),
      insightText: document.getElementById("insightText"),

      historyList: document.getElementById("historyList"),

      saveMorningBtn: document.getElementById("saveMorningBtn"),
      loadMorningBtn: document.getElementById("loadMorningBtn"),
      saveEveningBtn: document.getElementById("saveEveningBtn"),
      loadEveningBtn: document.getElementById("loadEveningBtn"),

      resetAllBtn: document.getElementById("resetAllBtn"),
      exportBtn: document.getElementById("exportBtn"),
      importBtn: document.getElementById("importBtn"),
      transferBox: document.getElementById("transferBox"),

      toast: document.getElementById("toast")
    };

    let currentISO = isoToday();

    function showToast(msg) {
      ui.toast.textContent = msg;
      ui.toast.classList.add("show");
      setTimeout(() => ui.toast.classList.remove("show"), 2200);
    }

    function setRangeDisplays() {
      ui.mRestedVal.textContent = ui.mRested.value;
      ui.mOptimismVal.textContent = ui.mOptimism.value;
      ui.mConfidenceVal.textContent = ui.mConfidence.value;

      ui.eHappyVal.textContent = ui.eHappy.value;
      ui.eFulfillVal.textContent = ui.eFulfill.value;
      ui.eChallengesVal.textContent = ui.eChallenges.value;
      ui.eConnectionVal.textContent = ui.eConnection.value;
      ui.eAlignVal.textContent = ui.eAlign.value;
    }

    function renderMode() {
      const state = getState();
      ui.deepToggle.checked = !!state.deepMode;
      ui.modePill.textContent = state.deepMode ? "Deep" : "Quick";
      ui.morningMetricsWrap.style.display = state.deepMode ? "block" : "none";
    }

    function renderTruthAndFoundation(day) {
      const t = TRUTHS[day.truthIndex];
      ui.truthText.textContent = t.truth;
      ui.truthQuestion.textContent = t.question;

      ui.rightTruth.textContent = t.truth;
      ui.rightQuestion.textContent = t.question;

      const f = FOUNDATIONS[day.foundationIndex];
      ui.foundationQ.textContent = f.q;
      ui.foundationHint.textContent = f.hint;
      ui.rightFoundation.textContent = f.q;
    }

    function renderMorning(day) {
      const m = day.morning;

      ui.mTruthAnswer.value = m.truthAnswer || "";
      ui.mFoundationAnswer.value = m.foundationAnswer || "";
      ui.mRested.value = m.rested ?? 5;
      ui.mOptimism.value = m.optimism ?? 5;
      ui.mConfidence.value = m.confidence ?? 5;
      ui.mIdentity.value = m.identity || "";
      ui.mAction.value = m.action || "";

      ui.morningSaved.textContent = m.savedAt ? `Saved ${m.savedAt}` : "Not saved";

      ui.rightIdentity.textContent = (m.identity || "").trim() ? m.identity.trim() : "Not set";
      ui.rightAction.textContent = (m.action || "").trim() ? m.action.trim() : "Not set";

      setRangeDisplays();
    }

    function renderEvening(day) {
      const e = day.evening;
      ui.eHappy.value = e.happy ?? 5;
      ui.eFulfill.value = e.fulfill ?? 5;
      ui.eChallenges.value = e.challenges ?? 5;
      ui.eConnection.value = e.connection ?? 5;
      ui.eSmile.value = e.smile || "";
      ui.eLearn.value = e.learn || "";
      ui.eAlign.value = e.align ?? 5;
      ui.eShort.value = e.short || "";
      ui.eProud.value = e.proud || "";
      ui.eFear.checked = !!e.fearFaced;
      ui.eTomorrow.value = e.tomorrow || "";
      ui.eveningSaved.textContent = e.savedAt ? `Saved ${e.savedAt}` : "Not saved";

      ui.identityEcho.textContent = (day.morning.identity || "").trim() ? day.morning.identity.trim() : "Not set";
      ui.actionEcho.textContent = (day.morning.action || "").trim() ? day.morning.action.trim() : "Not set";

      setRangeDisplays();
    }

    function renderTopStats() {
      const days = getDays();
      const day = ensureDay(currentISO);

      const streak = computeStreak(days);
      ui.streakPill.textContent = String(streak);

      ui.todayIso.textContent = currentISO;

      const v = isDayComplete(day) ? calcVitality(day) : 0;
      const c = isDayComplete(day) ? calcCourage(day) : 0;
      const m = isDayComplete(day) ? calcMeaning(day) : 0;

      ui.topVitality.textContent = v;
      ui.topCourage.textContent = c;
      ui.topMeaning.textContent = m;
    }

    function renderDashboard() {
      const days = getDays();
      const isos7 = getRecentIsos(7);
      const isos30 = getRecentIsos(30);

      const v7 = averageScore(days, isos7, calcVitality);
      const c7 = averageScore(days, isos7, calcCourage);
      const m7 = averageScore(days, isos7, calcMeaning);

      const v30 = averageScore(days, isos30, calcVitality);
      const c30 = averageScore(days, isos30, calcCourage);
      const m30 = averageScore(days, isos30, calcMeaning);

      if (v7 === null) {
        ui.avgText.textContent = "No complete days yet. Save Morning and Evening for at least one day.";
      } else {
        ui.avgText.textContent =
          `7 day averages: Vitality ${v7}, Courage ${c7}, Meaning ${m7}. ` +
          `30 day averages: Vitality ${v30 ?? "NA"}, Courage ${c30 ?? "NA"}, Meaning ${m30 ?? "NA"}.`;
      }

      ui.insightText.textContent = buildInsights(days);
    }

    function escapeHTML(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function dateLabel(iso) {
      const parts = iso.split("-").map(Number);
      const dt = new Date(parts[0], parts[1] - 1, parts[2]);
      return dt.toLocaleDateString(undefined, { weekday: "short", month: "short", day: "numeric" });
    }

    function renderHistory() {
      const days = getDays();
      const keys = Object.keys(days).sort((a, b) => b.localeCompare(a));

      if (keys.length === 0) {
        ui.historyList.innerHTML = `<div class="mutedLine">No history yet.</div>`;
        return;
      }

      ui.historyList.innerHTML = keys.map(iso => {
        const d = days[iso];
        const done = isDayComplete(d);
        const v = done ? calcVitality(d) : 0;
        const c = done ? calcCourage(d) : 0;
        const m = done ? calcMeaning(d) : 0;
        const meta = done ? `V ${v}  C ${c}  M ${m}` : "Incomplete";
        const truth = TRUTHS[d.truthIndex]?.truth || "Truth";
        const ident = d.morning.identity || "Not set";

        return `
          <div class="listItem" dataIso="${iso}">
            <div class="listHead">
              <div class="listDate">${escapeHTML(dateLabel(iso))} <span class="smallMeta">(${escapeHTML(iso)})</span></div>
              <div class="listMeta">${escapeHTML(meta)}</div>
            </div>
            <div class="mutedLine">Truth: ${escapeHTML(truth)}</div>
            <div class="mutedLine">Identity: ${escapeHTML(ident)}</div>
          </div>
        `;
      }).join("");

      Array.from(ui.historyList.querySelectorAll(".listItem")).forEach(el => {
        el.addEventListener("click", () => {
          const iso = el.getAttribute("dataIso");
          if (!iso) return;
          currentISO = iso;
          boot();
          switchTab("morningPanel");
        });
      });
    }

    function saveMorning() {
      const days = getDays();
      const day = ensureDay(currentISO);

      day.morning.truthAnswer = ui.mTruthAnswer.value.trim();
      day.morning.foundationAnswer = ui.mFoundationAnswer.value.trim();
      day.morning.rested = Number(ui.mRested.value);
      day.morning.optimism = Number(ui.mOptimism.value);
      day.morning.confidence = Number(ui.mConfidence.value);
      day.morning.identity = ui.mIdentity.value.trim();
      day.morning.action = ui.mAction.value.trim();
      day.morning.savedAt = nowStamp();

      days[currentISO] = day;
      setDays(days);

      renderMorning(day);
      renderEvening(day);
      renderTopStats();
      showToast("Morning saved.");
    }

    function saveEvening() {
      const days = getDays();
      const day = ensureDay(currentISO);

      day.evening.happy = Number(ui.eHappy.value);
      day.evening.fulfill = Number(ui.eFulfill.value);
      day.evening.challenges = Number(ui.eChallenges.value);
      day.evening.connection = Number(ui.eConnection.value);
      day.evening.smile = ui.eSmile.value.trim();
      day.evening.learn = ui.eLearn.value.trim();
      day.evening.align = Number(ui.eAlign.value);
      day.evening.short = ui.eShort.value.trim();
      day.evening.proud = ui.eProud.value.trim();
      day.evening.fearFaced = !!ui.eFear.checked;
      day.evening.tomorrow = ui.eTomorrow.value.trim();
      day.evening.savedAt = nowStamp();

      days[currentISO] = day;
      setDays(days);

      renderEvening(day);
      renderTopStats();
      renderDashboard();
      renderHistory();
      showToast("Evening saved.");
    }

    function loadMorning() {
      const day = ensureDay(currentISO);
      renderMorning(day);
      showToast("Morning loaded.");
    }

    function loadEvening() {
      const day = ensureDay(currentISO);
      renderEvening(day);
      showToast("Evening loaded.");
    }

    function resetAll() {
      const ok = window.confirm("This will delete all saved data on this device. Continue?");
      if (!ok) return;
      localStorage.removeItem(KEY_DAYS);
      boot(true);
      showToast("All data reset.");
    }

    function exportJSON() {
      const days = getDays();
      const payload = { version: "tiaDaysV2", exportedAt: new Date().toISOString(), days };
      ui.transferBox.value = JSON.stringify(payload, null, 2);
      showToast("Export ready.");
    }

    function importJSON() {
      try {
        const raw = ui.transferBox.value.trim();
        if (!raw) return;
        const parsed = JSON.parse(raw);
        if (!parsed.days) throw new Error("Missing days");
        setDays(parsed.days);
        boot();
        switchTab("historyPanel");
        showToast("Import complete.");
      } catch (e) {
        alert("Import failed. Check the JSON.");
      }
    }

    function hookTabs() {
      const btns = Array.from(document.querySelectorAll(".tabBtn"));
      btns.forEach(btn => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("dataTab");
          if (!target) return;
          switchTab(target);
        });
      });
    }

    function switchTab(panelId) {
      const btns = Array.from(document.querySelectorAll(".tabBtn"));
      const panels = Array.from(document.querySelectorAll(".panel"));

      btns.forEach(b => b.classList.toggle("active", b.getAttribute("dataTab") === panelId));
      panels.forEach(p => p.classList.toggle("active", p.id === panelId));

      const state = getState();
      state.lastTab = panelId;
      setState(state);

      if (panelId === "dashboardPanel") renderDashboard();
      if (panelId === "historyPanel") renderHistory();
    }

    function hookSliders() {
      const pairs = [
        [ui.mRested, ui.mRestedVal],
        [ui.mOptimism, ui.mOptimismVal],
        [ui.mConfidence, ui.mConfidenceVal],
        [ui.eHappy, ui.eHappyVal],
        [ui.eFulfill, ui.eFulfillVal],
        [ui.eChallenges, ui.eChallengesVal],
        [ui.eConnection, ui.eConnectionVal],
        [ui.eAlign, ui.eAlignVal]
      ];
      pairs.forEach(([r, v]) => r.addEventListener("input", () => v.textContent = r.value));
    }

    function hookMode() {
      ui.deepToggle.addEventListener("change", () => {
        const state = getState();
        state.deepMode = !!ui.deepToggle.checked;
        setState(state);
        renderMode();
        showToast(state.deepMode ? "Deep Mode on." : "Quick Mode on.");
      });
    }

    function hookButtons() {
      ui.saveMorningBtn.addEventListener("click", saveMorning);
      ui.loadMorningBtn.addEventListener("click", loadMorning);
      ui.saveEveningBtn.addEventListener("click", saveEvening);
      ui.loadEveningBtn.addEventListener("click", loadEvening);

      ui.resetAllBtn.addEventListener("click", resetAll);
      ui.exportBtn.addEventListener("click", exportJSON);
      ui.importBtn.addEventListener("click", importJSON);
    }

    function boot(afterReset) {
      if (afterReset) currentISO = isoToday();

      const state = getState();
      renderMode();

      const day = ensureDay(currentISO);

      renderTruthAndFoundation(day);
      renderMorning(day);
      renderEvening(day);

      renderTopStats();
      renderDashboard();
      renderHistory();

      ui.modePill.textContent = state.deepMode ? "Deep" : "Quick";
    }

    hookTabs();
    hookSliders();
    hookMode();
    hookButtons();

    const state = getState();
    boot();
    switchTab(state.lastTab || "morningPanel");
  </script>
</body>
</html>
